function followPath(obj,path,num){return null!=path[num]&&null!=obj[path[num]]?followPath(obj[path[num]],path,++num):obj}function clearAllTimeouts(){for(var id=setTimeout((function(){}));id--;)clearTimeout(id)}function getCanvas(width,height,stylemult){var canv=createElement("canvas",{width:width,height:height});return stylemult&&(stylemult=stylemult||unitsize,proliferate(canv.style,{width:width*stylemult+"px",height:height*stylemult+"px"})),canv.getContext("2d").webkitImageSmoothingEnabled=!1,canv}function step(num){unpause(),upkeep(),pause(),num>0&&step(num-1)}function fastforward(num){window.speed=max(0,parseInt(num||0))+1}function toggleFastFWD(num){window.fastforwarding?(fastforward(0),window.fastforwarding=!1):(fastforward(2),window.fastforwarding=!0)}function specifyTimer(timerin){timer=timerin,requestAnimationFrame=function(func){window.setTimeout(func,timer)}}function changeUnitsize(num){function setter(arr){for(i in arr)updateSize(arr[i]),updatePosition(arr[i])}num&&(resetUnitsize(num),setter(solids),setter(characters))}function randTrue(num){return floor(getSeed()*((num||1)+1))}function randSign(num){return 2*randTrue(num)-1}function randBoolJS(num){return floor(2*random())}function updatePosition(me){me.nomove||shiftHoriz(me,me.xvel),me.nofall||shiftVert(me,me.yvel)}function updateSize(me){var canvas;me.unitwidth=me.width*unitsize,me.unitheight=me.height*unitsize,me.spritewidthpixels=me.spritewidth*unitsize,me.spriteheightpixels=me.spriteheight*unitsize,(canvas=me.canvas)&&(canvas.width=me.spritewidthpixels,canvas.height=me.spriteheightpixels,refillThingCanvas(me))}function reduceHeight(me,dy,see){me.top+=dy,me.height-=dy/unitsize,see&&updateSize(me)}function shiftBoth(me,dx,dy){me.noshiftx||shiftHoriz(me,dx),me.noshifty||shiftVert(me,dy)}function shiftHoriz(me,dx){me.left+=dx,me.right+=dx}function shiftVert(me,dy){me.top+=dy,me.bottom+=dy}function setLeft(me,left){me.left=left,me.right=me.left+me.width*unitsize}function setRight(me,right){me.right=right,me.left=me.right-me.width*unitsize}function setTop(me,top){me.top=top,me.bottom=me.top+me.height*unitsize}function setBottom(me,bottom){me.bottom=bottom,me.top=me.bottom-me.height*unitsize}function setWidth(me,width,spriter,updater){me.width=width,me.unitwidth=width*unitsize,spriter&&(me.spritewidth=width,me.spritewidthpixels=width*unitsize),updater&&(updateSize(me),setThingSprite(me))}function setHeight(me,height,spriter,updater){me.height=height,me.unitheight=height*unitsize,spriter&&(me.spriteheight=height,me.spriteheightpixels=height*unitsize),updater&&(updateSize(me),setThingSprite(me))}function setSize(me,width,height,spriter,updater){width&&setWidth(me,width,spriter),height&&setHeight(me,height,spriter),updater&&(updateSize(me),setThingSprite(me))}function setMidX(me,left,see){setLeft(me,left+me.width*unitsized2,see)}function getMidX(me){return me.left+me.width*unitsized2}function setMidY(me,top,see){setTop(me,top+me.height*unitsized2,see)}function setMidXObj(me,object,see){setLeft(me,object.left+object.width*unitsized2-me.width*unitsized2,see)}function slideToXLoc(me,xloc,maxspeed,see){maxspeed=maxspeed||1/0;var midx=getMidX(me);shiftHoriz(me,midx<xloc?min(maxspeed,xloc-midx):max(-maxspeed,xloc-midx),see)}function updateLeft(me,dx){me.left+=dx,me.right=me.left+me.width*unitsize}function updateRight(me,dx){me.right+=dx,me.left=me.right-me.width*unitsize}function updateTop(me,dy){me.top+=dy,me.bottom=me.top+me.height*unitsize}function updateBottom(me,dy){me.bottom+=dy,me.top=me.bottom-me.height*unitsize}function increaseHeightTop(me,dy,spriter){me.top-=dy,me.height+=dy/unitsize,me.unitheight=me.height*unitsize}function determineThingCollisions(me){if(!me.nocollide){var cur,others,other,i,j,leni,lenj;for(me.resting&&0!=me.resting.yvel||(me.resting=!1),me.skipoverlaps||checkOverlap(me),i=0,leni=me.numquads;i<leni;++i)for(others=(cur=me.quadrants[i]).things,j=0,lenj=cur.numthings;j<lenj&&me!=(other=others[j]);++j)!other.alive||other.scenery||other.nocollide||!objectsTouch(me,other)||!me.player&&other.hidden&&other.visual_scenery&&other.visual_scenery.hidden&&!solidOnCharacter(other,me)||(other.character?objectsCollided(me,other):me.nocollidesolid||(objectsCollided(me,other),me.skipoverlaps||other.skipoverlaps||!characterOverlapsSolid(me,other)||me.overlaps.push(other)));me.undermid?me.undermid.bottomBump(me.undermid,me):me.under instanceof Thing&&me.under.bottomBump(me.under,me)}}function checkOverlap(me){if(me.overlapdir)me.overlapdir<0&&me.right<=me.ocheck.left+unitsizet2||me.left>=me.ocheck.right-unitsizet2?(me.overlapdir=0,me.overlaps=[]):shiftHoriz(me,me.overlapdir,!0);else if(me.overlaps.length>0){var over,i,overlaps=me.overlaps,right={right:-1/0},left={left:1/0},mid=0;for(i in me.overlapfix=!0,overlaps)mid+=getMidX(over=overlaps[i]),over.right>right.right&&(right=over),over.left<left.left&&(left=over);mid/=overlaps.length,getMidX(me)>=mid-unitsized16?(me.overlapdir=unitsize,me.ocheck=right):(me.overlapdir=-unitsize,me.ocheck=left)}}function characterOverlapsSolid(me,solid){return me.top<=solid.top&&me.bottom>solid.bottom}function objectsTouch(one,two){return one.right-unitsize>two.left&&one.left+unitsize<two.right&&one.bottom>=two.top&&one.top<=two.bottom}function charactersTouch(one,two){return!(one.bottom<=two.top+unitsizet2||one.top+unitsizet2>=two.bottom)}function objectInQuadrant(one,quad){return one.right+unitsize>=quad.left&&one.left-unitsize<=quad.right&&one.bottom+unitsize>=quad.top&&one.top-unitsize<=quad.bottom}function objectsCollided(one,two){return one.solid&&!two.solid?objectsCollided(two,one):two.up&&one!=two.up?characterTouchesUp(one,two):void(two.solid||one.player?two.collide(one,two):one.collide(two,one))}function objectToLeft(one,two){return(one.left+one.right)/2<(two.left+two.right)/2}function objectOnTop(one,two){return!("solid"==one.type&&two.yvel>0)&&(!(one.yvel<two.yvel&&"solid"!=two.type)&&(!!(one.player&&one.bottom<two.bottom&&"enemy"==two.group)||one.left+unitsize<two.right&&one.right-unitsize>two.left&&(one.bottom-two.yvel<=two.top+two.toly||one.bottom<=two.top+two.toly+abs(one.yvel-two.yvel))))}function objectOnSolid(one,two){return one.left+unitsize<two.right&&one.right-unitsize>two.left&&(one.bottom-one.yvel<=two.top+two.toly||one.bottom<=two.top+two.toly+abs(one.yvel-two.yvel))}function solidOnCharacter(solid,me){return!(me.yvel>=0)&&(me.midx=getMidX(me),me.midx>solid.left&&me.midx<solid.right&&solid.bottom-solid.yvel<=me.top+me.toly-me.yvel)}function characterOnSolid(me,solid){return me.resting==solid||objectOnSolid(me,solid)&&me.yvel>=0&&me.left+me.xvel+unitsize!=solid.right&&me.right-me.xvel-unitsize!=solid.left}function characterOnResting(me,solid){return objectOnSolid(me,solid)&&me.left+me.xvel+unitsize!=solid.right&&me.right-me.xvel-unitsize!=solid.left}function characterTouchedSolid(me,solid){if(solid.up!=me){if(characterOnSolid(me,solid)){if(solid.hidden)return;me.resting=solid,me.player&&map.underwater&&removeClass(me,"paddling")}else if(solidOnCharacter(solid,me)){var mid=me.left+me.width*unitsize/2;if(mid>solid.left&&mid<solid.right)me.undermid=solid;else if(solid.hidden)return;me.under?me.under.push(solid):me.under=[solid],me.player&&setTop(me,solid.bottom-me.toly+solid.yvel,!0),me.yvel=solid.yvel,me.player&&(me.keys.jump=0)}solid.hidden||characterNotBumping(me,solid)||objectOnTop(me,solid)||objectOnTop(solid,me)||me.under||me==solid.up||(me.right<=solid.right?(me.xvel=min(me.xvel,0),shiftHoriz(me,max(solid.left+unitsize-me.right,-unitsized2),!0)):me.left>=solid.left&&(me.xvel=max(me.xvel,0),shiftHoriz(me,min(solid.right-unitsize-me.left,unitsized2),!0)),me.player?solid.actionLeft&&solid.actionLeft(me,solid,solid.transport):(me.moveleft=!me.moveleft,"item"==me.group&&me.collide(solid,me)))}}function characterNotBumping(me,solid){return me.top+me.toly+abs(me.yvel)>solid.bottom}function characterTouchesUp(me,solid){switch(me.group){case"item":me.moveleft=getMidX(me)<=getMidX(solid)+unitsized2,characterHops(me);break;case"coin":me.animate(me);break;default:me.death(me,2),scoreEnemyBelow(me)}}function characterHops(me){me.yvel=-1.4*unitsize,me.resting=!1}function characterIsAlive(me){return!(!me||me.dead||!me.alive)}function scorePlayerShell(player,shell){return player.star?score(shell,200,!0):shell.resting?shell.peeking?score(shell,1e3,!0):score(shell,100,!0):score(shell,8e3,!0)}function scoreEnemyStomp(enemy){switch(enemy.type.split(" ")[0]){case"koopa":enemy.fly?400:100;break;case"bulletbill":case"cheepcheep":200;break;case"hammerbro":1e3;break;case"lakitu":800;break;default:100}}function scoreEnemyFire(enemy){var amount=200;switch(enemy.type.split(" ")[0]){case"goomba":amount=100;break;case"hammerbro":amount=1e3;break;case"bowser":amount=5e3;break;default:amount=200}scoreEnemyFin(enemy,amount)}function scoreEnemyStar(enemy){var amount=200;switch(enemy.type.split(" ")[0]){case"goomba":amount=100;break;case"hammerbro":amount=1e3;break;default:amount=200}scoreEnemyFin(enemy,amount),AudioPlayer.play("Kick")}function scoreEnemyBelow(enemy){var amount=100;if("hammerbro"===enemy.type.split(" ")[0])amount=1e3;else amount=100;scoreEnemyFin(enemy,amount)}function scoreEnemyFin(enemy,amount){score(enemy,amount,!0)}function moveSimple(me){me.direction!=me.moveleft&&(me.moveleft?(me.xvel=-me.speed,me.noflip||unflipHoriz(me)):(me.noflip||flipHoriz(me),me.xvel=me.speed),me.direction=me.moveleft)}function moveSmart(me){moveSimple(me),0!=me.yvel||me.resting&&!offResting(me)||(me.moveleft?shiftHoriz(me,unitsize,!0):shiftHoriz(me,-unitsize,!0),me.moveleft=!me.moveleft)}function offResting(me){return me.moveleft?me.right-unitsize<me.resting.left:me.left+unitsize>me.resting.right}function moveJumping(me){moveSimple(me),me.resting&&(me.yvel=-abs(me.jumpheight),me.resting=!1)}function moveFloating(me){setPlatformEndpoints(me),me.begin=map.floor*unitsize-me.begin,me.end=map.floor*unitsize-me.end,(me.movement=moveFloatingReal)(me)}function moveFloatingReal(me){me.top<me.end?me.yvel=min(me.yvel+unitsized32,me.maxvel):me.bottom>me.begin&&(me.yvel=max(me.yvel-unitsized32,-me.maxvel)),movePlatformNorm(me)}function moveSliding(me){setPlatformEndpoints(me),(me.movement=moveSlidingReal)(me)}function moveSlidingReal(me){gamescreen.left+me.left<me.begin?me.xvel=min(me.xvel+unitsized32,me.maxvel):gamescreen.left+me.right>me.end&&(me.xvel=max(me.xvel-unitsized32,-me.maxvel)),movePlatformNorm(me)}function setPlatformEndpoints(me){if(me.begin>me.end){var temp=me.begin;me.begin=me.end,me.end=temp}}function collideTransport(me,solid){characterTouchedSolid(me,solid),solid==me.resting&&(solid.movement=movePlatformNorm,solid.collide=characterTouchedSolid,solid.xvel=unitsized2)}function moveFalling(me){if(me!=player.resting)return me.yvel=0;shiftVert(me,me.yvel+=unitsized8),setBottom(player,me.top),me.yvel>=2.8*unitsize&&(me.freefall=!0,me.movement=moveFreeFalling)}function moveFallingScale(me){player.resting==me?(shiftScaleStringVert(me,me.string,me.yvel+=unitsized16),shiftScaleStringVert(me.partner,me.partner.string,-me.yvel),me.tension+=me.yvel,me.partner.tension-=me.yvel):me.yvel>0&&(shiftScaleStringVert(me,me.string,me.yvel-=unitsized32),shiftScaleStringVert(me.partner,me.partner.string,-me.yvel),me.tension-=me.yvel,me.partner.tension+=me.yvel),me.partner.tension<=0&&(me.collide=me.partner.collide=characterTouchedSolid,me.movement=me.partner.movement=moveFreeFalling)}function moveFreeFalling(me){shiftVert(me,me.yvel+=unitsized16),me.yvel>unitsizet2&&(me.movement=function(me){shiftVert(me,me.yvel)})}function shiftScaleStringVert(me,string,yvel){shiftVert(me,yvel),string.bottom=me.top,string.height=(string.bottom-string.top)/unitsize,updateSize(string)}function setClass(me,strin){me.className=strin,setThingSprite(me)}function setClassInitial(me,strin){me.className=strin}function addClass(me,strin){me.className+=" "+strin,setThingSprite(me)}function removeClass(me,strout){me.className=me.className.replace(new RegExp(" "+strout,"gm"),""),setThingSprite(me)}function switchClass(me,strout,strin){removeClass(me,strout),addClass(me,strin)}function removeClasses(me){var arr,i,j;for(i=1;i<arguments.length;++i)for((arr=arguments[i])instanceof Array||(arr=arr.split(" ")),j=arr.length-1;j>=0;--j)removeClass(me,arr[j])}function addClasses(me,strings){for(var arr=strings instanceof Array?strings:strings.split(" "),i=arr.length-1;i>=0;--i)addClass(me,arr[i])}function addElementClass(element,strin){element.className+=" "+strin}function removeElementClass(element,strin){element.className=element.className.replace(new RegExp(" "+strin,"gm"),"")}function flipHoriz(me){addClass(me,"flipped")}function flipVert(me){addClass(me,"flip-vert")}function unflipHoriz(me){removeClass(me,"flipped")}function unflipVert(me){removeClass(me,"flip-vert")}function deleteThing(me,array,arrayloc){array.splice(arrayloc,1),me.ondelete&&me.ondelete()}function switchContainers(me,outer,inner){outer.splice(outer.indexOf(me),1),inner.push(me)}function containerForefront(me,container){container.splice(container.indexOf(me),1),container.unshift(me)}function killNormal(me){me&&(me.hidden=me.dead=!0,me.alive=me.resting=me.movement=!1,TimeHandler.clearAllCycles(me))}function killFlip(me,extra){flipVert(me),me.bottomBump=function(){},me.nocollide=me.dead=!0,me.resting=me.movement=me.speed=me.xvel=me.nofall=!1,me.yvel=-unitsize,TimeHandler.addEvent((function(me){killNormal(me)}),70+(extra||0))}function generalMovement(me,dx,dy,cleartime){var move=setInterval((function(){shiftVert(me,dy),shiftHoriz(me,dx)}),timer);setTimeout((function(){clearInterval(move)}),cleartime)}function blockBumpMovement(me){var dir=-3,move=setInterval((function(){shiftVert(me,dir),3.5==(dir+=.5)&&(clearInterval(move),me.up=!1),determineThingCollisions(me)}),timer)}function emergeUp(me,solid){AudioPlayer.play("Powerup Appears"),flipHoriz(me),me.nomove=me.nocollide=me.alive=me.nofall=me.emerging=!0,switchContainers(me,characters,scenery);var move=setInterval((function(){shiftVert(me,-unitsized8),me.bottom<=solid.top&&(clearInterval(move),switchContainers(me,scenery,characters),me.nocollide=me.nomove=me.moveleft=me.nofall=me.emerging=!1,me.emergeOut&&me.emergeOut(me,solid),me.movement&&(me.movementsave=me.movement,me.movement=moveSimple,me.moving=TimeHandler.addEventInterval((function(me,solid){if(me.resting!=solid)return TimeHandler.addEvent((function(me){me.movement=me.movementsave}),1,me),!0}),1,1/0,me,solid)))}),timer)}function flicker(me,cleartime,interval){cleartime=round(cleartime)||49,interval=round(interval)||3;me.flickering=!0,TimeHandler.addEventInterval((function(me){me.hidden=!me.hidden}),interval,cleartime,me),TimeHandler.addEvent((function(me){me.flickering=me.hidden=!1}),cleartime*interval+1,me)}function killOtherCharacters(){var thing,i;if(window.characters)for(i=characters.length-1;i>=0;--i)(thing=characters[i]).nokillend?thing.killonend&&thing.killonend(thing):deleteThing(thing,characters,i);if(window.solids)for(i=solids.length-1;i>=0;--i)solids[i].killonend&&deleteThing(solids[i],solids,i)}function lookTowardPlayer(me,big){player.right<=me.left?me.lookleft&&!big||(me.lookleft=!0,me.moveleft=!1,unflipHoriz(me)):player.left>=me.right&&(me.lookleft||big)&&(me.lookleft=!1,me.moveleft=!0,flipHoriz(me))}function lookTowardThing(me,thing){thing.right<=me.left?(me.lookleft=!0,me.moveleft=!1,unflipHoriz(me)):thing.left>=me.right&&(me.lookleft=!1,me.moveleft=!0,flipHoriz(me))}